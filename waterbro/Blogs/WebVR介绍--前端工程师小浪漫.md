ä»ä»£ç è§’åº¦åˆçª¥è™šæ‹Ÿç°å®

> æ°´é¸¡æˆ‘å‘¢ï¼Œæœ€è¿‘é€‰äº†ä¸€é—¨è™šæ‹Ÿç°å®è¯¾ï¼Œç„¶åéœ€è¦å†™ä¸€ç¯‡ç›¸å…³å…¬ä¼—å·æ–‡ç« ï¼Œå¤§è‡´æ˜¯vrçš„æ¦‚å¿µä¹‹ç±»çš„ï¼Œä½†ä½œä¸ºä¸€ä¸ªå‰ç«¯å·¥ç¨‹å¸ˆï¼Œè‚¯å®šæ˜¯æƒ³æ•´æ´»çš„ï¼Œé‚£æˆ‘ä»¬é€šè¿‡å‡ æ®µä»£ç æ¥ç®€å•çœ‹çœ‹æ•ˆæœï¼ˆè°ƒæ¥å£é‚£ç§ ç®—æ³•åŸç†å°±ç®—äº†å“ˆå“ˆå“ˆå“ˆï¼‰ï¼Œå› ä¸ºç¯‡å¹…åŸå› ï¼Œæœ¬ç¯‡åªè®²three.jsä½¿ç”¨å…¥é—¨å’Œ   ~~ç½‘ä¸Šå¤åˆ¶æ¥çš„æ•™ç¨‹~~     è¾›è‹¦æ•´ç†çš„æ•™ç¨‹
>
> è™šæ‹ŸæŠ€æœ¯ï¼Œå…¶å®å°±æ˜¯ç”¨ç”µè„‘æ¨¡æ‹Ÿä¸€ä¸ªäº§ç”Ÿäº†3Dç©ºé—´çš„è™šæ‹Ÿä¸–ç•Œï¼Œæ‰“ç ´è§‚å¯Ÿè€…è§‚å¯Ÿ3Dç©ºé—´çš„é™åˆ¶

![img](https://gitee.com/szuwaterbrother/typora-pic-bed/raw/master/hmds.jpg)

## ç®€å•çš„åŸç†ä»‹ç»

WebVR APIæ˜¯ä¸­å¤®APIï¼Œç”¨äºæ•è·ä¸è®¡ç®—æœºç›¸è¿çš„VRè®¾å¤‡ä¸Šçš„ä¿¡æ¯ä»¥åŠå¤´æˆ´å¼è€³æœºçš„ä½ç½®/æ–¹å‘/é€Ÿåº¦/åŠ é€Ÿåº¦ä¿¡æ¯ï¼Œå¹¶å°†å…¶è½¬æ¢ä¸ºå¯ç”¨äºæ¸¸æˆå’Œå…¶ä»–åº”ç”¨ç¨‹åºçš„æœ‰ç”¨æ•°æ®ã€‚

WebVR APIåŸºäºä¸¤ä¸ªæ¦‚å¿µ-å°†ç«‹ä½“å›¾åƒå‘é€åˆ°è€³æœºä¸­çš„ä¸¤ä¸ªé•œå¤´å¹¶ä»ä¼ æ„Ÿå™¨æ¥æ”¶å¤´éƒ¨çš„ä½ç½®æ•°æ®ï¼Œè€Œè¿™ä¸¤ä¸ªåˆ™ç”±HMDVRDeviceï¼ˆå¤´æˆ´å¼æ˜¾ç¤ºå™¨è™šæ‹Ÿç°å®è®¾å¤‡ï¼‰å’ŒPositionSensorVRDeviceå¤„ç†ã€‚

**WebVRçš„ä½“éªŒæ–¹å¼å¯ä»¥åˆ†ä¸ºVRæ¨¡å¼å’Œè£¸çœ¼æ¨¡å¼**

***1.Mobile VR***

å¦‚ä½¿ç”¨cardboardçœ¼é•œæ¥ä½“éªŒæ‰‹æœºæµè§ˆå™¨çš„webVRç½‘é¡µï¼Œæµè§ˆå™¨å°†æ ¹æ®æ°´å¹³é™€èºä»ªçš„å‚æ•°æ¥è·å–ç”¨æˆ·çš„å¤´éƒ¨å€¾æ–œå’Œè½¬åŠ¨çš„æœå‘ï¼Œå¹¶å‘ŠçŸ¥é¡µé¢éœ€è¦æ¸²æŸ“å“ªä¸€ä¸ªæœå‘çš„åœºæ™¯ã€‚

***2.PC VR***

é€šè¿‡ä½©æˆ´Oculus Riftçš„åˆ†ç¦»å¼å¤´æ˜¾æµè§ˆè¿æ¥åœ¨PCä¸»æœºç«¯çš„ç½‘é¡µï¼Œç°æ”¯æŒWebVR APIçš„æµè§ˆå™¨ä¸»è¦æ˜¯ç«ç‹çš„ [Firefox Nightly](https://link.zhihu.com/?target=https%3A//nightly.mozilla.org/)å’Œè®¾ç½®VR enabledçš„è°·æ­Œchrome betaã€‚

é™¤äº†VRæ¨¡å¼ä¸‹çš„ä½“éªŒæ–¹å¼ï¼Œè¿™é‡Œè¿˜è€ƒè™‘äº†è£¸çœ¼ä¸‹çš„ä½“éªŒæµè§ˆç½‘é¡µçš„æ–¹å¼ï¼Œåœ¨PCç«¯å¦‚æœæ¢æµ‹çš„ç”¨æˆ·é€‰æ‹©è¿›å…¥VRæ¨¡å¼ï¼Œåº”è®©ç”¨æˆ·å¯ä»¥ä½¿ç”¨é¼ æ ‡æ‹–æ‹½åœºæ™¯ï¼Œè€Œåœ¨æ™ºèƒ½æ‰‹æœºä¸Šåˆ™åº”è®©ç”¨æˆ·å¯ä»¥ä½¿ç”¨touchmoveæˆ–æ—‹è½¬å€¾æ–œæ‰‹æœºçš„æ–¹å¼æ¥æ”¹å˜åœºæ™¯è§†è§’

![img](https://gitee.com/szuwaterbrother/typora-pic-bed/raw/master/v2-31d4c0da70d0a657e44754155a6b1230_720w.jpg)

ä½†æ˜¯ä»…ä»…æ˜¯çœ‹æ¦‚å¿µæ˜¯å¾ˆå¤´æ™•ä¸”æ²¡æ„æ€çš„ï¼Œåé¢æ¥åº·åº·ä»£ç å’Œæ•ˆæœ

åœ¨æœ¬æ–‡ç« æˆ‘ä»¬è®²æ¢è®¨WebVR APIæ¥å¢å¼ºThree.jsæ„å»ºçš„ç®€å•WebGLåœºæ™¯ï¼Œæˆ‘ä»¬å…ˆæ¥å­¦ä¹ ä¸‹ï¼Œå¦‚ä½•ç”¨Three.jsæ„å»ºä¸€ä¸ªâ€œå°†ä¸€ä¸ªç›’å­æ”¾å…¥ä¸€ä¸ªç«‹ä½“ç©ºé—´â€œçš„åœºæ™¯

## é€è¿‡ä»£ç å®ç°å¯¹æ¯”

### ç®€å•çš„3Dæ¨¡å‹

åœ¨æˆ‘ä»¬çš„3Dä¸–ç•Œä¸­ï¼Œæˆ‘ä»¬å°†æœ‰ä»¥ä¸‹ä¸€äº›å†…å®¹ï¼š

1. ä¸€ä¸ªåœºæ™¯
2. æ¸²æŸ“å™¨
3. ç›¸æœº
4. ä¸€ä¸¤ä¸ªç‰©ä½“ï¼ˆå¸¦ææ–™ï¼‰

**ä»£ç å¦‚ä¸‹ğŸ˜€**

```
<html>
  <head>
    <meta charset="utf-8" />
    <title>My first three.js app</title>
    <style>
      body {
        margin: 0;
      }
    </style>
  </head>
  <body>
    <script src="js/three.js"></script>
    <script>
      //åœºæ™¯å’Œç›¸æœº
      const scene = new THREE.Scene()
      const camera = new THREE.PerspectiveCamera(
        75,
        window.innerWidth / window.innerHeight,
        0.1,
        1000
      )
      //æ¸²æŸ“
      const renderer = new THREE.WebGLRenderer()
      renderer.setSize(window.innerWidth, window.innerHeight)
      document.body.appendChild(renderer.domElement)
      //æ­£æ–¹ä½“
      const geometry = new THREE.BoxGeometry()
      const material = new THREE.MeshBasicMaterial({ color: 0x00ff00 })
      const cube = new THREE.Mesh(geometry, material)
      scene.add(cube)
      //ç›¸æœºä½ç½®
      camera.position.z = 5
      //è®¾ç½®åŠ¨ç”»
      const animate = function () {
        requestAnimationFrame(animate)
        cube.rotation.x += 0.01
        cube.rotation.y += 0.01
        renderer.render(scene, camera)
      }

      animate()
    </script>
  </body>
</html>
```

æ•ˆæœå¦‚ä¸‹ï¼ˆæˆ‘ä»¬å¯ä»¥å†ç»˜åˆ¶ç½‘æ ¼çº¿ç»™å®ƒï¼Œè¿™é‡Œå°±ä¸ç”»äº†ï¼Œç¯‡å¹…é—®é¢˜ï¼Œç»¿å—åé¢æ˜¯æ•ˆæœï¼‰

![image-20210320223505397](https://gitee.com/szuwaterbrother/typora-pic-bed/raw/master/image-20210320223505397.png)

![image-20210321022104037](https://gitee.com/szuwaterbrother/typora-pic-bed/raw/master/image-20210321022104037.png)

### VRå¢å¼ºåçš„æ¨¡å‹

#### æ“ä½œ

##### æ‰¾å¯»VRæ˜¾ç¤ºå™¨

åœ¨æœ‰äº†ä¸€ä¸ª 3D åœºæ™¯åï¼Œä¸ºäº†ä½¿å…¶é€šè¿‡ WebVR è¿è¡Œæˆ‘ä»¬éœ€è¦åšäº›ä»€ä¹ˆï¼Ÿé¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æŸ¥è¯¢æµè§ˆå™¨ä»¥å‘ç°æ˜¯å¦æœ‰ä»»ä½•å¯ç”¨çš„ VR æ˜¾ç¤ºå™¨ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ navigator.getVRDisplays() æ‰§è¡Œæ­¤æ“ä½œã€‚

```
navigator.getVRDisplays().then(displays => {
  // è¿‡æ»¤åˆ°æ˜¾ç¤ºå¯å‘ˆç°è®¾å¤‡
  displays = displays.filter(display => display.capabilities.canPresent);

  // æ— è®¾å¤‡åˆ™æ¨å‡º
  if (displays.length === 0) {
    console.warn('No devices available able to present.');
    return;
  }

  // å­˜å‚¨æˆ‘ä»¬æ‰¾åˆ°çš„ç¬¬ä¸€ä¸ªæ˜¾ç¤ºå™¨. 
  // åé¢çš„ä¸¤ä¸ªæ˜¯ä¸ºäº†åé¢æ–¹ä¾¿ç”¨æˆ·è‡ªå·±åšé€‰æ‹©
  this._vr.display = displays[0];
  this._vr.display.depthNear = DemoVR.CAMERA_SETTINGS.near;
  this._vr.display.depthFar = DemoVR.CAMERA_SETTINGS.far;
});
```

##### æ¨¡æ‹ŸVRè®¾å¤‡

ä½ å¯ä»¥ç”¨chrome DevToolsæ‹“å±•ç¨‹åºæ¨¡æ‹Ÿä¸€å°è®¾å¤‡ï¼ˆå‡å¦‚ä½ æ˜¯åœ¨å¼€å‘é˜¶æ®µï¼‰åå­—å«åšWebVR API Emulation

![image-20210321023837909](https://gitee.com/szuwaterbrother/typora-pic-bed/raw/master/image-20210321023837909.png)

##### ä»è®¾å¤‡è¯·æ±‚æ˜¾ç¤º

```
this._vr.display.requestPresent([{
  source: this._renderer.domElement
}]);
```

##### ç»˜åˆ¶VRåœºæ™¯

è¿™é‡Œçš„è¯ï¼Œæ˜¯è¦ç»™ç”¨æˆ·æ˜¾ç¤ºä¸€ä¸ªVRåœºæ™¯

![image-20210321022637644](https://gitee.com/szuwaterbrother/typora-pic-bed/raw/master/image-20210321022637644.png)

æˆ‘ä»¬è¿™é‡Œè¦åšçš„å·¥ä½œæ˜¯

1. ç¡®ä¿ä½¿ç”¨è®¾å¤‡çš„ `requestAnimationFrame` å›è°ƒã€‚
2. ä» VR è®¾å¤‡è¯·æ±‚å½“å‰çš„å§¿åŠ¿ã€å±å¹•æ–¹å‘å’Œçœ¼ç›ä¿¡æ¯ã€‚
3. å°† WebGL ä¸Šä¸‹æ–‡åˆ†æˆä¸¤åŠï¼Œæ¯ä¸€åŠå¯¹åº”ä¸€åªçœ¼ç›ï¼Œå¹¶å•ç‹¬ç»˜åˆ¶ã€‚

```
_render () {
  this._vr.display.requestAnimationFrame(this._update);
  â€¦
}
//.........................
// ä»VRå¤´ç›”è·å–æ‰€æœ‰æœ€æ–°æ•°æ®ï¼Œå¹¶å°†å…¶è½¬å‚¨åˆ°frameDataã€‚
this._vr.display.getFrameData(this._vr.frameData);
this._vr.frameData = new VRFrameData();
//getFrameData() å°†é€‰å–ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒå°†æˆ‘ä»¬éœ€è¦çš„ä¿¡æ¯æ”¾ç½®åœ¨è¯¥å¯¹è±¡ä¸Šã€‚è¿™å¿…é¡»æ˜¯ä¸€ä¸ª VRFrameData å¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ new //VRFrameData() åˆ›å»ºå®ƒã€‚
this._vr.frameData = new VRFrameData();
```

### æ€»ç»“

~~å…¶å®æœ¬æ¬¡æ–‡ç« è¿˜æ˜¯ä¸ºäº†åº”ä»˜è€å¸ˆ~~ï¼ˆå¤§å®¶æœ‰å…´è¶£å¯ä»¥å»çœ‹Paul Lewisçš„GitHubæºç ï¼Œå¾ˆå¤šæœ‰æ„æ€çš„ä¸œè¥¿ï¼Œåé¢VRé‚£é‡Œæœ‰ç‚¹ä¸å¤ªç†è§£ï¼Œ~~å› ä¸ºä¸ä¼šç”¨VR~~ï¼Œæ‰€ä»¥å°±ç•¥ç•¥å¸¦è¿‡.... 